# 法线的微分

介绍一个数学公式，在交点 P 上，有法线 N，则法线相对 N 与 uv 的偏导数为的计算过程是：

![1](02_17/1.png)

这就是 Weingarten equations

计算流程如下:

![2](02_17/2.png)

# 表面积的计算方法

这里有个积分法的通用公式:

对于 ![3](02_17/3.png) 并且满足 ![4](02_17/4.png)

其表面积为:

![5](02_17/5.png)

# 圆柱面

圆柱面的表达式和uv表示

![7](02_17/7.png)

![6](02_17/6.png)

求交点

![8](02_17/8.png)

![9](02_17/9.png)

![10](02_17/10.png)

圆柱求与射线的交点与球体类似

![11](02_17/11.png)

 - 将射线转换到本地坐标系
 - 构建一元二次方程
 - 对一元二次方程求解, 得到较小的 t
 - 根据 t 计算 phi 和 hit point 的坐标
 - 进行Z Test 过滤一些可能不相交的情况
 - 计算 u,v 以及 dpdu, dpdv, dndu, dndv
 - 构建表面交点 SurfaceInteraction
 - 更新 tHit 变量, 记录 t

# 圆环

圆环需要 2个半径, 高度, 还有角度

![12](02_17/12.png)

![13](02_17/13.png)

![14](02_17/14.png)

与射线求交点

![15](02_17/15.png)

 - Ray 转换到 本地坐标系
 - 如果 Ray 和 Disk 平行，那么不会有交点
 - 求得交点, 与半径和角度范围比较
 - 计算 dpdu dpdv dndu dndv
 - 构建表面交点 SurfaceInteraction
 - 更新 tHit 变量, 记录 t

表面积

![16](02_17/16.png)

# 更多的二次曲面

这里包括圆锥体, 抛物面, 双曲线面

![17](02_17/17.png)

## 圆锥体

![18](02_17/18.png)

对于Z轴的圆锥体, 高度是 h, 半径是 r

转换到 uv

![19](02_17/19.png)

分别求一阶导数和二阶导数

![20](02_17/20.png)

![21](02_17/21.png)

### 抛物面 和 双曲面

![22](02_17/22.png)

![23](02_17/23.png)





